# 検査アプリケーション

AnomalyDINOを使用したBaumer産業カメラによるフィルム検査システム

## main.py - メインアプリケーション

### 概要
Baumer産業カメラとAnomalyDINOを組み合わせたフィルム検査のメインアプリケーションです。TkEasyGUIを使用したGUIアプリケーションで、連続的な自動検査と手動検査モードを提供します。

### 主な機能
- 製品別の検査設定（マスター画像、カメラパラメータ、モデルパラメータ）
- 自動検査モード（連続撮影→推論→判定の繰り返し）
- 手動検査モード（ユーザー操作による単発検査）
- リアルタイム結果表示（OK/NG判定、異常スコア表示）
- NGの場合の自動ログ保存（画像とスコア）
- ブザー音によるNG通知

### 実行方法
```bash
python main.py
```

### 実行フロー
1. 品種選択画面で検査対象製品を選択
2. 検査ウィンドウで自動検査開始
3. 設定された間隔で撮影→推論→判定を繰り返し
4. 必要に応じて手動検査モードに切り替え可能

## app_capture.py - 画像撮影アプリ

### 概要
Baumer産業カメラを使用した画像撮影専用のGUIアプリケーションです。指定枚数の画像を連続撮影し、指定ディレクトリに保存します。

### 主な機能
- カメラパラメータの設定ファイル読み込み
- 指定枚数の連続撮影
- 保存先ディレクトリの指定
- リアルタイムでの撮影進捗表示
- タイムスタンプ付きファイル名での自動保存

### 実行方法
```bash
python app_capture.py
```

### 使用方法
1. 撮影枚数を入力
2. 保存ディレクトリを指定
3. 必要に応じてカメラ設定ファイルを変更
4. 「撮影開始」ボタンで撮影実行

## app_generate_master.py - マスター特徴量生成アプリ

### 概要
各製品のマスター画像からAnomalyDINO用の特徴量ファイル（master.npy）とROI領域の平均Hue値（master_hue.txt）を生成するGUIアプリケーションです。

### 主な機能
- masterフォルダ内の製品一覧表示
- 複数製品の一括処理対応
- AnomalyDINO特徴量（master.npy）の生成
- ROI領域平均Hue値（master_hue.txt）の計算
- 処理進捗の表示

### 実行方法
```bash
python app_generate_master.py
```

### 使用方法
1. 処理対象製品をリストから選択（複数選択可能）
2. 「特徴量生成開始」ボタンで処理実行
3. 各製品のmasterフォルダにmaster.npyとmaster_hue.txtが生成される

## analyze_score.py - 異常度分析・プロット生成

### 概要
指定ディレクトリ内のBMP画像に対して異常度計算を行い、時系列プロットを生成するコマンドラインツールです。複数のマスターに対する比較分析が可能です。

### 主な機能
- 指定ディレクトリ以下の全BMP画像の異常度計算
- 複数マスターとの比較分析
- 時系列プロットの自動生成
- 最小異常度画像のROI付き保存
- DINOスコアとHueスコアの統合評価

### 実行方法
```bash
# 基本的な使用例
python analyze_score.py --target_dir data/2025_07_17

# パラメータ指定例
python analyze_score.py \
    --target_dir data/2025_07_17 \
    --masters NKR 標準 特級 \
    --roi_rel 0.70 0.93 0.11 0.39 \
    --sat_thresh 40 \
    --hue_weight 0.10
```

### 主要パラメータ
- `--model_type`: 使用するモデルタイプ 
- `--feat_layer`: 特徴量抽出層
- `--image_size`: 画像サイズ
- `--target_dir`: 処理対象ディレクトリ
- `--masters`: 使用するマスター（複数指定可能）
- `--roi_rel`: ROI相対座標 (y_start, y_end, x_start, x_end)
- `--sat_thresh`: 彩度しきい値（デフォルト: 40）
- `--hue_weight`: Hue重み係数（デフォルト: 0.10）

### 出力ファイル
- 時系列プロット画像（PNG形式）
- 最小異常度画像（ROI表示付きBMP形式）
- analyzeフォルダに実行日時付きで保存