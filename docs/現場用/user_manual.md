# フィルム検査アプリ - ユーザーマニュアル

## 1. はじめに

### このアプリについて
このアプリは、産業用カメラ（Baumer社製）とAI（人工知能）を使って、製品のフィルムが正しいものかどうかを自動で検査するためのツールです。人の目の代わりに、AIが「見本（マスター）」と見比べて、間違いがないかをチェックします。

---

## 2. アプリの使い方

### ステップ0: PCを起動する
- このPCには電源ボタンが存在せず、電源が入力された瞬間に起動する仕様となっているため、電源に接続した瞬間にPCが起動する。
- 起動後しばらく待つと、デスクトップ画面が表示される。
- ログイン時のパスワードは **password** 。

### ステップ1: アプリを起動する
デスクトップのアプリのアイコンをクリックしてアプリを起動する。

<img src="picture/001.png" width="500">  

**注意点：**
- アプリの起動前に、必要なPythonライブラリがインストールされていることを確認してください
- 産業用カメラ（Baumer）がPCに正しく接続されていることを確認してください
- 初回起動時は、依存関係の読み込みに時間がかかる場合があります

### ステップ2: 検査する製品を選ぶ
アプリが起動すると、最初に「品種選択」ウィンドウが表示されます。

1.  リストの中から、これから検査したい製品の名前をクリックして選びます。
2.  `[検査開始]` ボタンを押します。

<img src="picture/002.png" width="500">  


### ステップ3: 検査画面の見方
検査画面は、主に4つの部分から構成されています。

<img src="picture/003.png" width="500">   

| 番号 | 名前 | 説明 |
|:---:|:---|:---|
| ① | **マスター画像** | お手本となる「正しい製品」の画像 |
| ② | **ライブ画像** | カメラが撮影している「検査対象」の画像 |
| ③ | **検査結果** | 検査結果が「OK」か「NG」で表示されます。スコアが低いほどマスターとの類似度が高い|
| ④ | **操作パネル** | 検査モードの切り替えや、アプリの停止を行うボタン |

---

## 3. 検査モードについて
### ① 自動検査モード（アプリ起動時のモード）
- アプリが自動的に製品の検査を繰り返すモード。

**自動検査の開始方法：**
1. 品種選択ウィンドウで検査したい製品をリストから選択。
2. `[検査開始]` ボタンをクリック。
3. 検査ウィンドウが開き、自動的に自動検査モードが開始される。

**動作について**
1. 設定された時間（デフォルト：5秒間）、カメラで連続撮影。
2. 撮影したフレームの中から、最適なフレームを選択してAIが判定。
3. 結果を画面に表示します（スコアとOK/NG判定）
4. 設定された休止時間（デフォルト：1秒間）待機して、また1.から繰り返す。

**状態の見方：**
- 「待機中」: システムが検査のための準備をしている状態
- 「撮影中」: カメラで画像を撮影している状態
- 「検査中」: AIが画像を解析している状態
- 「休止中」: 次の検査まで待機している状態

### ② 手動検査モード
- 自分の好きなタイミングで、1回だけ検査を行いたいときに使うモード。

**手動検査の開始方法：**
1. **モードを切り替える**
   - 検査画面で `[手動検査]` ボタンを押す。
   - 自動検査が停止し、手動モードに切り替わる。
   - 画面上部の「モード」表示が「手動検査」に変わる。

   <img src="picture/004.png" width="500">   

2. **検査を実行する**
   - `[撮影＆判定開始]` ボタンを押す。
   - ボタンを押すと、設定された時間（デフォルト：5秒間）カメラで撮影し、AIが判定して結果を表示する。
   - 撮影から判定まで自動で行われるため、ボタンを押した後は結果が出るまで時間がかかるためしばらく待つ。

   <img src="picture/005.png" width="500">  

3. **自動検査に戻る**
   - `[自動検査再開]` ボタンを押すと、いつでも自動検査モードに戻ることが可能。
   - 自動検査が再開され、継続的な検査が始まる。

   <img src="picture/006.png" width="500">  


**手動検査の特徴：**
- 任意のタイミングで1回だけ検査を実行できます
- 自動検査の連続サイクルを止めて、特定のタイミングで検査したい場合に便利。
- 検査結果は自動検査と同様に画面に表示され、NG判定の場合はログに保存される。

---

## 4. アプリの終了
- 検査を完全に終了したい場合は、`[停止]` ボタンを押すか、ウィンドウ右上の「×」ボタンを押す。

<img src="picture/007.png" width="500">  

---

## 5. PCのシャットダウン（正常終了）
- デスクトップ右上の電源アイコンをクリックし、シャットダウンを行う。

<img src="picture/009.png" width="500">

---

## 6. 検査結果確認
- NGが発生したときのライブ画像(.png)とscore(.txt)が保存される。
（OK時のデータは保存されない。）
- 上限は設定で変更可能で、デフォルトは10000枚まで保存され、古いデータから順に削除される。

1. **デスクトップの"Kagome-Inspection-App"を開く**

<img src="picture/010.png" width="500">


2. **"logs" フォルダを開く**

<img src="picture/011.png" width="500">

3. **見たいデータを探して確認**
NGが発生したときの西暦-月-日-時-分-秒でファイル名がつけられているので、見たい日時のデータをクリックして確認する。

<img src="picture/012.png" width="500">

---

## 7. 設定変更
- 各製品の閾値など、一部の設定がアプリから変更可能。

1. **設定画面を表示**
   - 品種選択画面で `[パラメータ設定]` ボタンを押す。
   - パラメータ設定ウィンドウが立ち上がる。

   <img src="picture/013.png" width="500"> 

2. **設定を変更し保存**
   - パラメータ設定ウィンドウの値を変更する。
   - 終わったら、`[保存]` ボタンを押す。

   <img src="picture/014.png" width="500"> 


**設定変更ログ：**
- 設定を変更するたびに、いつどのようなパラメータを変更したかの履歴が .json 形式で残る。
- 検査結果確認時と同様に、デスクトップの"Kagome-Inspection-App"を開くと、"logs_setting" フォルダがあり、そこに格納されている。

<img src="picture/015.png" width="500"> 


**パラメータの説明：**

| パラメータ名 | デフォルト値 | 設定範囲 | 重要度 | 説明・用途 |
|:---|:---:|:---:|:---:|:---|
| **動画撮影時間**<br>(video_seconds) | 5秒 | 1～30秒 | ★★ | 1回の検査で画像を撮影し続ける時間。長くすると検査精度向上の可能性があるが、処理時間も長くなる |
| **スリープ時間**<br>(sleep_seconds) | 1秒 | 1～300秒 | ★★ | 検査終了から次の検査開始までの待機時間。製品交換時間に合わせて調整 |
| **閾値（しきい値）**<br>(threshold) | 0.2 | 0.05～1.0 | ★★★ | **最重要**：AIのOK/NG判定基準。小さくすると厳しく、大きくすると緩くなる |
| **フレーム間引き間隔**<br>(frame_skip_interval) | 2 | 1～10 | ★ | フレーム取得時の間引き間隔。大きくすると処理速度向上するが精度が下がる可能性 |
| **表示サイズ**<br>(display_size) | 640 | 320～1024 | ★ | 画面表示される画像サイズ（ピクセル）。見やすさに応じて調整 |
| **ウィンドウサイズ**<br>(window_size) | [1600,900] | 幅1280～1920<br>高さ720～1080 | ★ | アプリケーションウィンドウの大きさ。モニター解像度に合わせて調整 |
| **最大ログファイル数**<br>(max_log_files) | 10000 | 1000～50000 | ★ | 保存するNGデータの最大数。ディスク容量に応じて調整 |
| **バッファステップダウン**<br>(buffer_step_down) | 10 | 5～50 | - | カメラ画像取得時のバッファ設定。通常は変更不要 |


### パラメータ変更時の注意点

1. **製品別設定**: 各製品ごとに個別設定可能
2. **設定保存**: 変更後は必ず「保存」ボタンを押す  
3. **変更ログ**: 履歴はlogs_settingフォルダに自動保存
4. **テスト実行**: 変更後は実際の製品でテスト検査を実施
5. **段階的調整**: 大幅な変更は避け、少しずつ調整する

### よくある調整パターン

| 目的 | 調整するパラメータ | 設定例 |
|:---|:---|:---|
| **検査を厳しくする** | 閾値を下げる<br>撮影時間を延長 | 0.2→0.15<br>5秒→10秒 |
| **検査を緩くする** | 閾値を上げる | 0.2→0.25 |
| **検査速度を上げる** | 撮影時間短縮<br>スリープ時間短縮<br>フレーム間引き間隔拡大 | 5秒→3秒<br>1秒→0.5秒<br>2→3 |
| **画面表示改善** | 表示サイズ調整<br>ウィンドウサイズ調整 | 640→800<br>[1600,900]→[1920,1080] |

---

## 8. トラブルシューティング
-   **PCがフリーズした**
    - フリーズして正常終了ができない場合は、コンセントとPCのケーブル間のジャックを抜き差しして再起動する。

-   **カメラ接続エラーが出る**
    - カメラとPCを接続しているLANケーブルが、カメラ側とPC側で正常に接続できているかを確認。

-   **動作が少し遅く感じる**
    - AIによる画像判定は、コンピュータに高い負荷をかける高度な処理であるため、ある程度の動作の重さは正常な状態。よほど遅い場合は、開発者や管理者に相談。

-   **その他:**
    - 社内担当者へ連絡し、それでも解決が難しい場合は下記問い合わせ窓口まで連絡。

---
